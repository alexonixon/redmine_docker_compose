TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER trigInsIssues BEFORE INSERT ON issues\nFOR EACH ROW\nBEGIN\nIF NEW.status_id IN(5, 6) THEN\n   SET new.closed_date = NOW();\nELSE\n   SET new.closed_date = NULL;\nEND IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `trigCreateTime_entries` AFTER INSERT ON `issues` FOR EACH ROW BEGIN\nIF new.project_id NOT IN (541) THEN\nINSERT INTO time_entries (project_id, user_id, issue_id, hours, comments, activity_id, spent_on, tyear, tmonth, tweek, created_on, updated_on)\nValues (new.project_id, new.author_id, new.id, 0.08, \'Cоздание задачи\', 9, NOW(), year(NOW()), month(NOW()), week(NOW()), NOW(), NOW());\nEND IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER trigUpdIssues BEFORE UPDATE ON issues\nFOR EACH ROW\nBEGIN\nIF NEW.status_id IN(5, 6) THEN\n   IF OLD.status_id NOT IN(5, 6) THEN\n      SET new.closed_date = NOW();\n   END IF;\nELSE\n   SET new.closed_date = NULL;\nEND IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `create_time_entries` AFTER UPDATE ON `issues` FOR EACH ROW BEGIN\nIF old.status_id = 7 AND new.status_id !=7  THEN\nINSERT INTO time_entries (project_id, user_id, issue_id, hours, comments, activity_id, spent_on, tyear, tmonth, tweek, created_on, updated_on)\nValues (new.project_id, old.assigned_to_id, old.id,(SELECT ROUND ((SELECT TIMESTAMPDIFF(MINUTE, ifnull((select j.created_on from journals j inner join journal_details st ON j.id = st.journal_id AND st.prop_key = "status_id" where j.journalized_id = new.id order By j.created_on DESC LIMIT 1 ),old.created_on), NOW()))/ 60, 2)), \'Решение задачи\', 9, NOW(), year(NOW()), month(NOW()), week(NOW()), NOW(), NOW());\nEND IF;\nEND'
sql_modes=0 0 0 0
definers='root@localhost' 'root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8' 'utf8' 'utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
